@model NoticiasAdmin.Models.Noticia
@{
    ViewData["Title"] = "Crear Noticia";
}

<h2><i class="fas fa-plus-circle me-2"></i>Nueva Noticia</h2>
<hr />

<div class="row">
    <div class="col-md-8">
        <form asp-action="Create" method="post" id="formNoticia">
            <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

            <div class="mb-3">
                <label asp-for="Titulo" class="form-label">
                    Título <span class="text-danger">*</span>
                </label>
                <input asp-for="Titulo" class="form-control"
                       placeholder="Ingrese un título descriptivo..."
                       required
                       maxlength="100" />
                <span asp-validation-for="Titulo" class="text-danger"></span>
                <div class="invalid-feedback">
                    El título es obligatorio (máximo 100 caracteres).
                </div>
                <small class="form-text text-muted" id="tituloCounter"></small>
            </div>

            <div class="mb-3">
                <label asp-for="Resumen" class="form-label">
                    Resumen
                </label>
                <textarea asp-for="Resumen" class="form-control" rows="2"
                          placeholder="Breve resumen de la noticia..."
                          maxlength="150"></textarea>
                <span asp-validation-for="Resumen" class="text-danger"></span>
                <small class="form-text text-muted">Opcional - Este resumen aparecerá en las tarjetas de vista previa (máximo 150 caracteres)</small>
            </div>

            <div class="mb-3">
                <label asp-for="Contenido" class="form-label">
                    Contenido <span class="text-danger">*</span>
                </label>
                <textarea asp-for="Contenido" class="form-control" rows="8"
                          placeholder="Escriba el contenido completo de la noticia..."
                          required
                          minlength="100"></textarea>
                <span asp-validation-for="Contenido" class="text-danger"></span>
                <div class="invalid-feedback">
                    El contenido es obligatorio (mínimo 100 caracteres).
                </div>
                <small class="form-text text-muted" id="contenidoCounter"></small>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label asp-for="CategoriaId" class="form-label">
                        Categoría <span class="text-danger">*</span>
                    </label>
                    <select asp-for="CategoriaId" class="form-select" asp-items="ViewBag.CategoriaId" required>
                        <option value="">-- Seleccione una categoría --</option>
                    </select>
                    <span asp-validation-for="CategoriaId" class="text-danger"></span>
                    <div class="invalid-feedback">
                        Por favor, seleccione una categoría.
                    </div>
                </div>

                <div class="col-md-6 mb-3">
                    <label asp-for="PaisId" class="form-label">
                        País <span class="text-danger">*</span>
                    </label>
                    <select asp-for="PaisId" class="form-select" asp-items="ViewBag.PaisId" required>
                        <option value="">-- Seleccione un país --</option>
                    </select>
                    <span asp-validation-for="PaisId" class="text-danger"></span>
                    <div class="invalid-feedback">
                        Por favor, seleccione un país.
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="ImagenUrl" class="form-label">
                    URL de Imagen
                </label>
                <input asp-for="ImagenUrl" class="form-control"
                       type="url"
                       placeholder="https://ejemplo.com/imagen.jpg"
                       maxlength="500" />
                <span asp-validation-for="ImagenUrl" class="text-danger"></span>
                <small class="form-text text-muted">Opcional - URL completa de la imagen de portada</small>
            </div>

            <div class="mb-3">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save me-1"></i>Guardar Noticia
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg">
                    <i class="fas fa-arrow-left me-1"></i>Cancelar
                </a>
            </div>
        </form>
    </div>

    <div class="col-md-4">
        <div class="alert alert-info">
            <h5><i class="fas fa-lightbulb me-2"></i>Campos Requeridos</h5>
            <p>Los campos marcados con <span class="text-danger">*</span> son obligatorios:</p>
            <ul class="mb-0">
                <li><strong>Título:</strong> Máximo 100 caracteres</li>
                <li><strong>Contenido:</strong> Mínimo 100 caracteres</li>
                <li><strong>Categoría:</strong> Debe seleccionar una</li>
                <li><strong>País:</strong> Debe seleccionar uno</li>
            </ul>
        </div>

        <div class="card">
            <div class="card-header bg-success text-white">
                <h6 class="mb-0"><i class="fas fa-info-circle me-2"></i>Información</h6>
            </div>
            <div class="card-body">
                <p class="mb-2"><small><strong>Estado:</strong> Se publicará como Activa</small></p>
                <p class="mb-2"><small><strong>Fecha:</strong> Se asignará automáticamente</small></p>
                <p class="mb-0"><small><strong>Autor:</strong> Tu usuario será registrado</small></p>
            </div>
        </div>

        <div class="alert alert-warning mt-3">
            <h6><i class="fas fa-exclamation-triangle me-2"></i>Consejos</h6>
            <ul class="mb-0">
                <li>Usa un título claro y descriptivo</li>
                <li>El resumen debe captar la atención</li>
                <li>Desarrolla bien el contenido</li>
                <li>Usa imágenes de buena calidad</li>
            </ul>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        (function() {
            'use strict';
            const form = document.getElementById('formNoticia');

            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);

            // Contador de caracteres para título
            const tituloInput = document.querySelector('input[name="Titulo"]');
            const tituloCounter = document.getElementById('tituloCounter');
            if (tituloInput && tituloCounter) {
                function updateTituloCounter() {
                    const length = tituloInput.value.length;
                    tituloCounter.textContent = `${length}/100 caracteres`;
                    tituloCounter.style.color = length > 50 ? '#dc3545' : '#6c757d';
                }
                tituloInput.addEventListener('input', updateTituloCounter);
                updateTituloCounter();
            }

            // Contador de caracteres para contenido
            const contenidoTextarea = document.querySelector('textarea[name="Contenido"]');
            const contenidoCounter = document.getElementById('contenidoCounter');
            if (contenidoTextarea && contenidoCounter) {
                function updateContenidoCounter() {
                    const length = contenidoTextarea.value.length;
                    contenidoCounter.textContent = `${length} caracteres (mínimo 100)`;
                    if (length < 100) {
                        contenidoCounter.style.color = '#dc3545';
                    } else if (length > 5000) {
                        contenidoCounter.style.color = '#ffc107';
                    } else {
                        contenidoCounter.style.color = '#28a745';
                    }
                }
                contenidoTextarea.addEventListener('input', updateContenidoCounter);
                updateContenidoCounter();
            }
        })();
    </script>
}